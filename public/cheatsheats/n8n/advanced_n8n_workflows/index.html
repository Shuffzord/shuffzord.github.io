<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta
  name="author"
  content=""
/>
<meta
  name="description"
  content="Advanced n8n Workflow Examples - Database &amp; API Integration Complex workflows with error handling, data validation, and multi-step processing. These examples demonstrate enterprise-level automation patterns.
1. CRM Data Synchronization with Error Handling Purpose: Sync external CRM data to local database with comprehensive error handling Use Case: Customer data synchronization, inventory management, data warehousing
{ &#34;name&#34;: &#34;CRM to Database Sync with Error Handling&#34;, &#34;nodes&#34;: [ { &#34;parameters&#34;: { &#34;rule&#34;: { &#34;interval&#34;: [ { &#34;field&#34;: &#34;cronExpression&#34;, &#34;expression&#34;: &#34;0 */4 * * *&#34; } ] } }, &#34;id&#34;: &#34;schedule-sync&#34;, &#34;name&#34;: &#34;Every 4 Hours&#34;, &#34;type&#34;: &#34;n8n-nodes-base.scheduleTrigger&#34;, &#34;typeVersion&#34;: 1.2, &#34;position&#34;: [240, 400] }, { &#34;parameters&#34;: { &#34;method&#34;: &#34;GET&#34;, &#34;url&#34;: &#34;https://api.crm-system.com/v2/contacts&#34;, &#34;authentication&#34;: &#34;predefinedCredentialType&#34;, &#34;nodeCredentialType&#34;: &#34;httpHeaderAuth&#34;, &#34;sendQuery&#34;: true, &#34;queryParameters&#34;: { &#34;parameters&#34;: [ { &#34;name&#34;: &#34;limit&#34;, &#34;value&#34;: &#34;100&#34; }, { &#34;name&#34;: &#34;updated_since&#34;, &#34;value&#34;: &#34;={{ $workflow.lastSuccessTime || DateTime.now().minus({days: 1}).toISO() }}&#34; }, { &#34;name&#34;: &#34;include_deleted&#34;, &#34;value&#34;: &#34;true&#34; } ] }, &#34;options&#34;: { &#34;pagination&#34;: { &#34;paginationMode&#34;: &#34;updateAParameterInEachRequest&#34;, &#34;paginationCompleteExpression&#34;: &#34;={{ !$response.body.has_more }}&#34;, &#34;limitPagesFetched&#34;: true, &#34;maxRequests&#34;: 20, &#34;pageSize&#34;: 100 }, &#34;retry&#34;: { &#34;enabled&#34;: true, &#34;maxTries&#34;: 3, &#34;waitBetweenTries&#34;: 2000 }, &#34;timeout&#34;: 15000 } }, &#34;id&#34;: &#34;fetch-crm-data&#34;, &#34;name&#34;: &#34;Fetch CRM Contacts&#34;, &#34;type&#34;: &#34;n8n-nodes-base.httpRequest&#34;, &#34;typeVersion&#34;: 4.2, &#34;position&#34;: [460, 400], &#34;credentials&#34;: { &#34;httpHeaderAuth&#34;: { &#34;id&#34;: &#34;crm-api-credentials&#34;, &#34;name&#34;: &#34;CRM API Key&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $json.contacts &amp;&amp; Array.isArray($json.contacts) &amp;&amp; $json.contacts.length &gt; 0 }}&#34;, &#34;operation&#34;: &#34;equal&#34;, &#34;rightValue&#34;: true } } }, &#34;id&#34;: &#34;check-data-exists&#34;, &#34;name&#34;: &#34;Has Contact Data?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [680, 400] }, { &#34;parameters&#34;: { &#34;fieldToSplitOut&#34;: &#34;contacts&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;split-contacts&#34;, &#34;name&#34;: &#34;Split Contact Array&#34;, &#34;type&#34;: &#34;n8n-nodes-base.itemLists&#34;, &#34;typeVersion&#34;: 3.3, &#34;position&#34;: [900, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Validate and transform contact data\nconst validContacts = [];\nconst invalidContacts = [];\n\nfor (const item of $input.all()) {\n const contact = item.json;\n const errors = [];\n \n // Validation rules\n if (!contact.email || !/^[^\\s@]&#43;@[^\\s@]&#43;\\.[^\\s@]&#43;$/.test(contact.email)) {\n errors.push(&#39;Invalid or missing email&#39;);\n }\n \n if (!contact.id || contact.id.toString().length &lt; 1) {\n errors.push(&#39;Missing contact ID&#39;);\n }\n \n if (!contact.first_name || contact.first_name.trim().length &lt; 1) {\n errors.push(&#39;Missing first name&#39;);\n }\n \n if (contact.phone &amp;&amp; !/^[\\&#43;]?[1-9][\\d\\s\\-\\(\\)]{7,15}$/.test(contact.phone.replace(/\\s/g, &#39;&#39;))) {\n errors.push(&#39;Invalid phone number format&#39;);\n }\n \n if (errors.length === 0) {\n // Transform valid contact\n const transformedContact = {\n external_id: contact.id.toString(),\n first_name: contact.first_name.trim(),\n last_name: (contact.last_name || &#39;&#39;).trim(),\n email: contact.email.toLowerCase().trim(),\n phone: contact.phone ? contact.phone.replace(/[^\\d\\&#43;]/g, &#39;&#39;) : null,\n company: (contact.company || &#39;&#39;).trim() || null,\n status: contact.status || &#39;active&#39;,\n tags: Array.isArray(contact.tags) ? contact.tags.join(&#39;,&#39;) : null,\n created_at: contact.created_date || contact.created_at,\n updated_at: contact.updated_date || contact.updated_at,\n is_deleted: contact.is_deleted || false,\n sync_timestamp: new Date().toISOString(),\n source: &#39;crm_sync&#39;\n };\n \n validContacts.push({ json: transformedContact });\n } else {\n // Log invalid contact\n invalidContacts.push({ \n json: { \n original_contact: contact, \n validation_errors: errors,\n rejected_at: new Date().toISOString()\n } \n });\n \n console.log(`Invalid contact ${contact.id}: ${errors.join(&#39;, &#39;)}`);\n }\n}\n\nconsole.log(`Processed ${$input.all().length} contacts: ${validContacts.length} valid, ${invalidContacts.length} invalid`);\n\n// Store invalid contacts for later review\nif (invalidContacts.length &gt; 0) {\n $workflow.staticData.invalidContacts = invalidContacts;\n}\n\nreturn validContacts;&#34; }, &#34;id&#34;: &#34;validate-transform&#34;, &#34;name&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1120, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;select&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;public&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;contacts&#34; }, &#34;where&#34;: { &#34;values&#34;: [ { &#34;column&#34;: &#34;external_id&#34;, &#34;condition&#34;: &#34;equal&#34;, &#34;value&#34;: &#34;={{ $json.external_id }}&#34; } ] }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;check-contact-exists&#34;, &#34;name&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1340, 320], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $(&#39;Check if Contact Exists&#39;).itemMatching($itemIndex).json }}&#34;, &#34;operation&#34;: &#34;isNotEmpty&#34; } } }, &#34;id&#34;: &#34;contact-exists-check&#34;, &#34;name&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1560, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;update&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;updateKey&#34;: &#34;external_id&#34;, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34; } }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;update-contact&#34;, &#34;name&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 220], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;insert&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;external_id&#34;: &#34;={{ $json.external_id }}&#34;, &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;created_at&#34;: &#34;={{ $json.created_at }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34;, &#34;source&#34;: &#34;={{ $json.source }}&#34; } }, &#34;options&#34;: { &#34;ignoreDuplicates&#34;: true } }, &#34;id&#34;: &#34;insert-contact&#34;, &#34;name&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 420], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;mode&#34;: &#34;combine&#34;, &#34;combinationMode&#34;: &#34;multiplex&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;merge-results&#34;, &#34;name&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;n8n-nodes-base.merge&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2000, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Generate sync summary report\nconst allResults = $input.all();\nconst totalProcessed = allResults.length;\n\nconst summary = {\n sync_completed_at: new Date().toISOString(),\n total_contacts_processed: totalProcessed,\n successful_operations: totalProcessed,\n failed_operations: 0,\n invalid_contacts: $workflow.staticData.invalidContacts?.length || 0,\n sync_duration_seconds: Math.round((Date.now() - new Date($(&#39;Every 4 Hours&#39;).first().json.timestamp || Date.now()).getTime()) / 1000),\n next_sync_scheduled: DateTime.now().plus({ hours: 4 }).toISO()\n};\n\n// Log invalid contacts if any\nif ($workflow.staticData.invalidContacts?.length &gt; 0) {\n console.log(&#39;Invalid contacts found:&#39;, JSON.stringify($workflow.staticData.invalidContacts, null, 2));\n}\n\nreturn [{ json: summary }];&#34; }, &#34;id&#34;: &#34;generate-summary&#34;, &#34;name&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [2220, 320] }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#data-sync&#34;, &#34;text&#34;: &#34;âœ… CRM Sync Completed Successfully\n\nðŸ“Š *Sync Summary:*\nâ€¢ Total Contacts: {{ $json.total_contacts_processed }}\nâ€¢ Successful: {{ $json.successful_operations }}\nâ€¢ Failed: {{ $json.failed_operations }}\nâ€¢ Invalid: {{ $json.invalid_contacts }}\nâ€¢ Duration: {{ $json.sync_duration_seconds }}s\nâ€¢ Next Sync: {{ DateTime.fromISO($json.next_sync_scheduled).toLocaleString() }}\n\nðŸ• Completed: {{ DateTime.fromISO($json.sync_completed_at).toLocaleString() }}&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;CRM Sync Bot&#34;, &#34;icon_emoji&#34;: &#34;:arrows_counterclockwise:&#34; } }, &#34;id&#34;: &#34;success-notification&#34;, &#34;name&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2440, 320], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#alerts&#34;, &#34;text&#34;: &#34;âŒ CRM Sync Failed\n\n*Error Details:*\nâ€¢ Workflow: {{ $workflow.name }}\nâ€¢ Error: {{ $json.error?.message || &#39;Unknown error&#39; }}\nâ€¢ Time: {{ new Date().toISOString() }}\nâ€¢ Node: {{ $json.error?.node || &#39;Unknown&#39; }}\n\n*Stack Trace:*\n```{{ $json.error?.stack || &#39;No stack trace available&#39; }}```&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;Error Bot&#34;, &#34;icon_emoji&#34;: &#34;:x:&#34; } }, &#34;id&#34;: &#34;error-notification&#34;, &#34;name&#34;: &#34;Send Error Alert&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [900, 580], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } } ], &#34;connections&#34;: { &#34;Every 4 Hours&#34;: { &#34;main&#34;: [ [] ] }, &#34;Split Contact Array&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Validate &amp; Transform Data&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Check if Contact Exists&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Contact Exists?&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ], [ { &#34;node&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Update Existing Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Insert New Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 1 } ] ] }, &#34;Merge Update/Insert Results&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Generate Sync Summary&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] } }, &#34;active&#34;: false, &#34;settings&#34;: { &#34;executionOrder&#34;: &#34;v1&#34;, &#34;saveDataErrorExecution&#34;: &#34;all&#34;, &#34;saveDataSuccessExecution&#34;: &#34;all&#34;, &#34;saveManualExecutions&#34;: true, &#34;callerPolicy&#34;: &#34;workflowsFromSameOwner&#34;, &#34;errorWorkflow&#34;: { &#34;id&#34;: &#34;error-handler-workflow&#34; } }, &#34;versionId&#34;: &#34;crm-sync-advanced-v1&#34;, &#34;meta&#34;: { &#34;templateCredsSetupCompleted&#34;: true }, &#34;id&#34;: &#34;crm-database-sync-advanced&#34;, &#34;tags&#34;: [&#34;crm&#34;, &#34;database&#34;, &#34;synchronization&#34;, &#34;error-handling&#34;, &#34;validation&#34;] } 2. Multi-Step Order Processing Pipeline Purpose: Complex order processing with inventory checks, payment processing, and fulfillment Use Case: E-commerce order management, supply chain automation
"
/>
<meta
  name="keywords"
  content="homepage, blog"
/>
<meta name="robots" content="noodp" /> <meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/cheatsheats/n8n/advanced_n8n_workflows/" />


<title>
    :: Principles  
</title>



<link
  href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css"
  rel="stylesheet"
  type="text/css"
/>

 
<link rel="stylesheet" href="/main.17863a81d979b637a02cd7632a4d86e9d80563ef460fd6af1a56962efcaa066b.css" />  
<link rel="stylesheet" type="text/css" href="/css/math.css" />   
<link rel="stylesheet" type="text/css" href="/css/custom.css" />    <script type="text/javascript" src="http://localhost:1313/js/custom.js"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">
    <meta name="theme-color" content="">

 
  <meta itemprop="name" content="Principles">
  <meta itemprop="description" content="Advanced n8n Workflow Examples - Database &amp; API Integration Complex workflows with error handling, data validation, and multi-step processing. These examples demonstrate enterprise-level automation patterns.
1. CRM Data Synchronization with Error Handling Purpose: Sync external CRM data to local database with comprehensive error handling Use Case: Customer data synchronization, inventory management, data warehousing
{ &#34;name&#34;: &#34;CRM to Database Sync with Error Handling&#34;, &#34;nodes&#34;: [ { &#34;parameters&#34;: { &#34;rule&#34;: { &#34;interval&#34;: [ { &#34;field&#34;: &#34;cronExpression&#34;, &#34;expression&#34;: &#34;0 */4 * * *&#34; } ] } }, &#34;id&#34;: &#34;schedule-sync&#34;, &#34;name&#34;: &#34;Every 4 Hours&#34;, &#34;type&#34;: &#34;n8n-nodes-base.scheduleTrigger&#34;, &#34;typeVersion&#34;: 1.2, &#34;position&#34;: [240, 400] }, { &#34;parameters&#34;: { &#34;method&#34;: &#34;GET&#34;, &#34;url&#34;: &#34;https://api.crm-system.com/v2/contacts&#34;, &#34;authentication&#34;: &#34;predefinedCredentialType&#34;, &#34;nodeCredentialType&#34;: &#34;httpHeaderAuth&#34;, &#34;sendQuery&#34;: true, &#34;queryParameters&#34;: { &#34;parameters&#34;: [ { &#34;name&#34;: &#34;limit&#34;, &#34;value&#34;: &#34;100&#34; }, { &#34;name&#34;: &#34;updated_since&#34;, &#34;value&#34;: &#34;={{ $workflow.lastSuccessTime || DateTime.now().minus({days: 1}).toISO() }}&#34; }, { &#34;name&#34;: &#34;include_deleted&#34;, &#34;value&#34;: &#34;true&#34; } ] }, &#34;options&#34;: { &#34;pagination&#34;: { &#34;paginationMode&#34;: &#34;updateAParameterInEachRequest&#34;, &#34;paginationCompleteExpression&#34;: &#34;={{ !$response.body.has_more }}&#34;, &#34;limitPagesFetched&#34;: true, &#34;maxRequests&#34;: 20, &#34;pageSize&#34;: 100 }, &#34;retry&#34;: { &#34;enabled&#34;: true, &#34;maxTries&#34;: 3, &#34;waitBetweenTries&#34;: 2000 }, &#34;timeout&#34;: 15000 } }, &#34;id&#34;: &#34;fetch-crm-data&#34;, &#34;name&#34;: &#34;Fetch CRM Contacts&#34;, &#34;type&#34;: &#34;n8n-nodes-base.httpRequest&#34;, &#34;typeVersion&#34;: 4.2, &#34;position&#34;: [460, 400], &#34;credentials&#34;: { &#34;httpHeaderAuth&#34;: { &#34;id&#34;: &#34;crm-api-credentials&#34;, &#34;name&#34;: &#34;CRM API Key&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $json.contacts &amp;&amp; Array.isArray($json.contacts) &amp;&amp; $json.contacts.length &gt; 0 }}&#34;, &#34;operation&#34;: &#34;equal&#34;, &#34;rightValue&#34;: true } } }, &#34;id&#34;: &#34;check-data-exists&#34;, &#34;name&#34;: &#34;Has Contact Data?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [680, 400] }, { &#34;parameters&#34;: { &#34;fieldToSplitOut&#34;: &#34;contacts&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;split-contacts&#34;, &#34;name&#34;: &#34;Split Contact Array&#34;, &#34;type&#34;: &#34;n8n-nodes-base.itemLists&#34;, &#34;typeVersion&#34;: 3.3, &#34;position&#34;: [900, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Validate and transform contact data\nconst validContacts = [];\nconst invalidContacts = [];\n\nfor (const item of $input.all()) {\n const contact = item.json;\n const errors = [];\n \n // Validation rules\n if (!contact.email || !/^[^\\s@]&#43;@[^\\s@]&#43;\\.[^\\s@]&#43;$/.test(contact.email)) {\n errors.push(&#39;Invalid or missing email&#39;);\n }\n \n if (!contact.id || contact.id.toString().length &lt; 1) {\n errors.push(&#39;Missing contact ID&#39;);\n }\n \n if (!contact.first_name || contact.first_name.trim().length &lt; 1) {\n errors.push(&#39;Missing first name&#39;);\n }\n \n if (contact.phone &amp;&amp; !/^[\\&#43;]?[1-9][\\d\\s\\-\\(\\)]{7,15}$/.test(contact.phone.replace(/\\s/g, &#39;&#39;))) {\n errors.push(&#39;Invalid phone number format&#39;);\n }\n \n if (errors.length === 0) {\n // Transform valid contact\n const transformedContact = {\n external_id: contact.id.toString(),\n first_name: contact.first_name.trim(),\n last_name: (contact.last_name || &#39;&#39;).trim(),\n email: contact.email.toLowerCase().trim(),\n phone: contact.phone ? contact.phone.replace(/[^\\d\\&#43;]/g, &#39;&#39;) : null,\n company: (contact.company || &#39;&#39;).trim() || null,\n status: contact.status || &#39;active&#39;,\n tags: Array.isArray(contact.tags) ? contact.tags.join(&#39;,&#39;) : null,\n created_at: contact.created_date || contact.created_at,\n updated_at: contact.updated_date || contact.updated_at,\n is_deleted: contact.is_deleted || false,\n sync_timestamp: new Date().toISOString(),\n source: &#39;crm_sync&#39;\n };\n \n validContacts.push({ json: transformedContact });\n } else {\n // Log invalid contact\n invalidContacts.push({ \n json: { \n original_contact: contact, \n validation_errors: errors,\n rejected_at: new Date().toISOString()\n } \n });\n \n console.log(`Invalid contact ${contact.id}: ${errors.join(&#39;, &#39;)}`);\n }\n}\n\nconsole.log(`Processed ${$input.all().length} contacts: ${validContacts.length} valid, ${invalidContacts.length} invalid`);\n\n// Store invalid contacts for later review\nif (invalidContacts.length &gt; 0) {\n $workflow.staticData.invalidContacts = invalidContacts;\n}\n\nreturn validContacts;&#34; }, &#34;id&#34;: &#34;validate-transform&#34;, &#34;name&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1120, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;select&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;public&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;contacts&#34; }, &#34;where&#34;: { &#34;values&#34;: [ { &#34;column&#34;: &#34;external_id&#34;, &#34;condition&#34;: &#34;equal&#34;, &#34;value&#34;: &#34;={{ $json.external_id }}&#34; } ] }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;check-contact-exists&#34;, &#34;name&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1340, 320], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $(&#39;Check if Contact Exists&#39;).itemMatching($itemIndex).json }}&#34;, &#34;operation&#34;: &#34;isNotEmpty&#34; } } }, &#34;id&#34;: &#34;contact-exists-check&#34;, &#34;name&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1560, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;update&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;updateKey&#34;: &#34;external_id&#34;, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34; } }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;update-contact&#34;, &#34;name&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 220], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;insert&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;external_id&#34;: &#34;={{ $json.external_id }}&#34;, &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;created_at&#34;: &#34;={{ $json.created_at }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34;, &#34;source&#34;: &#34;={{ $json.source }}&#34; } }, &#34;options&#34;: { &#34;ignoreDuplicates&#34;: true } }, &#34;id&#34;: &#34;insert-contact&#34;, &#34;name&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 420], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;mode&#34;: &#34;combine&#34;, &#34;combinationMode&#34;: &#34;multiplex&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;merge-results&#34;, &#34;name&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;n8n-nodes-base.merge&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2000, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Generate sync summary report\nconst allResults = $input.all();\nconst totalProcessed = allResults.length;\n\nconst summary = {\n sync_completed_at: new Date().toISOString(),\n total_contacts_processed: totalProcessed,\n successful_operations: totalProcessed,\n failed_operations: 0,\n invalid_contacts: $workflow.staticData.invalidContacts?.length || 0,\n sync_duration_seconds: Math.round((Date.now() - new Date($(&#39;Every 4 Hours&#39;).first().json.timestamp || Date.now()).getTime()) / 1000),\n next_sync_scheduled: DateTime.now().plus({ hours: 4 }).toISO()\n};\n\n// Log invalid contacts if any\nif ($workflow.staticData.invalidContacts?.length &gt; 0) {\n console.log(&#39;Invalid contacts found:&#39;, JSON.stringify($workflow.staticData.invalidContacts, null, 2));\n}\n\nreturn [{ json: summary }];&#34; }, &#34;id&#34;: &#34;generate-summary&#34;, &#34;name&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [2220, 320] }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#data-sync&#34;, &#34;text&#34;: &#34;âœ… CRM Sync Completed Successfully\n\nðŸ“Š *Sync Summary:*\nâ€¢ Total Contacts: {{ $json.total_contacts_processed }}\nâ€¢ Successful: {{ $json.successful_operations }}\nâ€¢ Failed: {{ $json.failed_operations }}\nâ€¢ Invalid: {{ $json.invalid_contacts }}\nâ€¢ Duration: {{ $json.sync_duration_seconds }}s\nâ€¢ Next Sync: {{ DateTime.fromISO($json.next_sync_scheduled).toLocaleString() }}\n\nðŸ• Completed: {{ DateTime.fromISO($json.sync_completed_at).toLocaleString() }}&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;CRM Sync Bot&#34;, &#34;icon_emoji&#34;: &#34;:arrows_counterclockwise:&#34; } }, &#34;id&#34;: &#34;success-notification&#34;, &#34;name&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2440, 320], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#alerts&#34;, &#34;text&#34;: &#34;âŒ CRM Sync Failed\n\n*Error Details:*\nâ€¢ Workflow: {{ $workflow.name }}\nâ€¢ Error: {{ $json.error?.message || &#39;Unknown error&#39; }}\nâ€¢ Time: {{ new Date().toISOString() }}\nâ€¢ Node: {{ $json.error?.node || &#39;Unknown&#39; }}\n\n*Stack Trace:*\n```{{ $json.error?.stack || &#39;No stack trace available&#39; }}```&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;Error Bot&#34;, &#34;icon_emoji&#34;: &#34;:x:&#34; } }, &#34;id&#34;: &#34;error-notification&#34;, &#34;name&#34;: &#34;Send Error Alert&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [900, 580], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } } ], &#34;connections&#34;: { &#34;Every 4 Hours&#34;: { &#34;main&#34;: [ [] ] }, &#34;Split Contact Array&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Validate &amp; Transform Data&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Check if Contact Exists&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Contact Exists?&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ], [ { &#34;node&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Update Existing Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Insert New Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 1 } ] ] }, &#34;Merge Update/Insert Results&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Generate Sync Summary&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] } }, &#34;active&#34;: false, &#34;settings&#34;: { &#34;executionOrder&#34;: &#34;v1&#34;, &#34;saveDataErrorExecution&#34;: &#34;all&#34;, &#34;saveDataSuccessExecution&#34;: &#34;all&#34;, &#34;saveManualExecutions&#34;: true, &#34;callerPolicy&#34;: &#34;workflowsFromSameOwner&#34;, &#34;errorWorkflow&#34;: { &#34;id&#34;: &#34;error-handler-workflow&#34; } }, &#34;versionId&#34;: &#34;crm-sync-advanced-v1&#34;, &#34;meta&#34;: { &#34;templateCredsSetupCompleted&#34;: true }, &#34;id&#34;: &#34;crm-database-sync-advanced&#34;, &#34;tags&#34;: [&#34;crm&#34;, &#34;database&#34;, &#34;synchronization&#34;, &#34;error-handling&#34;, &#34;validation&#34;] } 2. Multi-Step Order Processing Pipeline Purpose: Complex order processing with inventory checks, payment processing, and fulfillment Use Case: E-commerce order management, supply chain automation">
  <meta itemprop="wordCount" content="2986">
  <meta itemprop="image" content="http://localhost:1313/"> 
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/">
  <meta name="twitter:title" content="Principles">
  <meta name="twitter:description" content="Advanced n8n Workflow Examples - Database &amp; API Integration Complex workflows with error handling, data validation, and multi-step processing. These examples demonstrate enterprise-level automation patterns.
1. CRM Data Synchronization with Error Handling Purpose: Sync external CRM data to local database with comprehensive error handling Use Case: Customer data synchronization, inventory management, data warehousing
{ &#34;name&#34;: &#34;CRM to Database Sync with Error Handling&#34;, &#34;nodes&#34;: [ { &#34;parameters&#34;: { &#34;rule&#34;: { &#34;interval&#34;: [ { &#34;field&#34;: &#34;cronExpression&#34;, &#34;expression&#34;: &#34;0 */4 * * *&#34; } ] } }, &#34;id&#34;: &#34;schedule-sync&#34;, &#34;name&#34;: &#34;Every 4 Hours&#34;, &#34;type&#34;: &#34;n8n-nodes-base.scheduleTrigger&#34;, &#34;typeVersion&#34;: 1.2, &#34;position&#34;: [240, 400] }, { &#34;parameters&#34;: { &#34;method&#34;: &#34;GET&#34;, &#34;url&#34;: &#34;https://api.crm-system.com/v2/contacts&#34;, &#34;authentication&#34;: &#34;predefinedCredentialType&#34;, &#34;nodeCredentialType&#34;: &#34;httpHeaderAuth&#34;, &#34;sendQuery&#34;: true, &#34;queryParameters&#34;: { &#34;parameters&#34;: [ { &#34;name&#34;: &#34;limit&#34;, &#34;value&#34;: &#34;100&#34; }, { &#34;name&#34;: &#34;updated_since&#34;, &#34;value&#34;: &#34;={{ $workflow.lastSuccessTime || DateTime.now().minus({days: 1}).toISO() }}&#34; }, { &#34;name&#34;: &#34;include_deleted&#34;, &#34;value&#34;: &#34;true&#34; } ] }, &#34;options&#34;: { &#34;pagination&#34;: { &#34;paginationMode&#34;: &#34;updateAParameterInEachRequest&#34;, &#34;paginationCompleteExpression&#34;: &#34;={{ !$response.body.has_more }}&#34;, &#34;limitPagesFetched&#34;: true, &#34;maxRequests&#34;: 20, &#34;pageSize&#34;: 100 }, &#34;retry&#34;: { &#34;enabled&#34;: true, &#34;maxTries&#34;: 3, &#34;waitBetweenTries&#34;: 2000 }, &#34;timeout&#34;: 15000 } }, &#34;id&#34;: &#34;fetch-crm-data&#34;, &#34;name&#34;: &#34;Fetch CRM Contacts&#34;, &#34;type&#34;: &#34;n8n-nodes-base.httpRequest&#34;, &#34;typeVersion&#34;: 4.2, &#34;position&#34;: [460, 400], &#34;credentials&#34;: { &#34;httpHeaderAuth&#34;: { &#34;id&#34;: &#34;crm-api-credentials&#34;, &#34;name&#34;: &#34;CRM API Key&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $json.contacts &amp;&amp; Array.isArray($json.contacts) &amp;&amp; $json.contacts.length &gt; 0 }}&#34;, &#34;operation&#34;: &#34;equal&#34;, &#34;rightValue&#34;: true } } }, &#34;id&#34;: &#34;check-data-exists&#34;, &#34;name&#34;: &#34;Has Contact Data?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [680, 400] }, { &#34;parameters&#34;: { &#34;fieldToSplitOut&#34;: &#34;contacts&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;split-contacts&#34;, &#34;name&#34;: &#34;Split Contact Array&#34;, &#34;type&#34;: &#34;n8n-nodes-base.itemLists&#34;, &#34;typeVersion&#34;: 3.3, &#34;position&#34;: [900, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Validate and transform contact data\nconst validContacts = [];\nconst invalidContacts = [];\n\nfor (const item of $input.all()) {\n const contact = item.json;\n const errors = [];\n \n // Validation rules\n if (!contact.email || !/^[^\\s@]&#43;@[^\\s@]&#43;\\.[^\\s@]&#43;$/.test(contact.email)) {\n errors.push(&#39;Invalid or missing email&#39;);\n }\n \n if (!contact.id || contact.id.toString().length &lt; 1) {\n errors.push(&#39;Missing contact ID&#39;);\n }\n \n if (!contact.first_name || contact.first_name.trim().length &lt; 1) {\n errors.push(&#39;Missing first name&#39;);\n }\n \n if (contact.phone &amp;&amp; !/^[\\&#43;]?[1-9][\\d\\s\\-\\(\\)]{7,15}$/.test(contact.phone.replace(/\\s/g, &#39;&#39;))) {\n errors.push(&#39;Invalid phone number format&#39;);\n }\n \n if (errors.length === 0) {\n // Transform valid contact\n const transformedContact = {\n external_id: contact.id.toString(),\n first_name: contact.first_name.trim(),\n last_name: (contact.last_name || &#39;&#39;).trim(),\n email: contact.email.toLowerCase().trim(),\n phone: contact.phone ? contact.phone.replace(/[^\\d\\&#43;]/g, &#39;&#39;) : null,\n company: (contact.company || &#39;&#39;).trim() || null,\n status: contact.status || &#39;active&#39;,\n tags: Array.isArray(contact.tags) ? contact.tags.join(&#39;,&#39;) : null,\n created_at: contact.created_date || contact.created_at,\n updated_at: contact.updated_date || contact.updated_at,\n is_deleted: contact.is_deleted || false,\n sync_timestamp: new Date().toISOString(),\n source: &#39;crm_sync&#39;\n };\n \n validContacts.push({ json: transformedContact });\n } else {\n // Log invalid contact\n invalidContacts.push({ \n json: { \n original_contact: contact, \n validation_errors: errors,\n rejected_at: new Date().toISOString()\n } \n });\n \n console.log(`Invalid contact ${contact.id}: ${errors.join(&#39;, &#39;)}`);\n }\n}\n\nconsole.log(`Processed ${$input.all().length} contacts: ${validContacts.length} valid, ${invalidContacts.length} invalid`);\n\n// Store invalid contacts for later review\nif (invalidContacts.length &gt; 0) {\n $workflow.staticData.invalidContacts = invalidContacts;\n}\n\nreturn validContacts;&#34; }, &#34;id&#34;: &#34;validate-transform&#34;, &#34;name&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1120, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;select&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;public&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;contacts&#34; }, &#34;where&#34;: { &#34;values&#34;: [ { &#34;column&#34;: &#34;external_id&#34;, &#34;condition&#34;: &#34;equal&#34;, &#34;value&#34;: &#34;={{ $json.external_id }}&#34; } ] }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;check-contact-exists&#34;, &#34;name&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1340, 320], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $(&#39;Check if Contact Exists&#39;).itemMatching($itemIndex).json }}&#34;, &#34;operation&#34;: &#34;isNotEmpty&#34; } } }, &#34;id&#34;: &#34;contact-exists-check&#34;, &#34;name&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1560, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;update&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;updateKey&#34;: &#34;external_id&#34;, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34; } }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;update-contact&#34;, &#34;name&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 220], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;insert&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;external_id&#34;: &#34;={{ $json.external_id }}&#34;, &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;created_at&#34;: &#34;={{ $json.created_at }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34;, &#34;source&#34;: &#34;={{ $json.source }}&#34; } }, &#34;options&#34;: { &#34;ignoreDuplicates&#34;: true } }, &#34;id&#34;: &#34;insert-contact&#34;, &#34;name&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 420], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;mode&#34;: &#34;combine&#34;, &#34;combinationMode&#34;: &#34;multiplex&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;merge-results&#34;, &#34;name&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;n8n-nodes-base.merge&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2000, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Generate sync summary report\nconst allResults = $input.all();\nconst totalProcessed = allResults.length;\n\nconst summary = {\n sync_completed_at: new Date().toISOString(),\n total_contacts_processed: totalProcessed,\n successful_operations: totalProcessed,\n failed_operations: 0,\n invalid_contacts: $workflow.staticData.invalidContacts?.length || 0,\n sync_duration_seconds: Math.round((Date.now() - new Date($(&#39;Every 4 Hours&#39;).first().json.timestamp || Date.now()).getTime()) / 1000),\n next_sync_scheduled: DateTime.now().plus({ hours: 4 }).toISO()\n};\n\n// Log invalid contacts if any\nif ($workflow.staticData.invalidContacts?.length &gt; 0) {\n console.log(&#39;Invalid contacts found:&#39;, JSON.stringify($workflow.staticData.invalidContacts, null, 2));\n}\n\nreturn [{ json: summary }];&#34; }, &#34;id&#34;: &#34;generate-summary&#34;, &#34;name&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [2220, 320] }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#data-sync&#34;, &#34;text&#34;: &#34;âœ… CRM Sync Completed Successfully\n\nðŸ“Š *Sync Summary:*\nâ€¢ Total Contacts: {{ $json.total_contacts_processed }}\nâ€¢ Successful: {{ $json.successful_operations }}\nâ€¢ Failed: {{ $json.failed_operations }}\nâ€¢ Invalid: {{ $json.invalid_contacts }}\nâ€¢ Duration: {{ $json.sync_duration_seconds }}s\nâ€¢ Next Sync: {{ DateTime.fromISO($json.next_sync_scheduled).toLocaleString() }}\n\nðŸ• Completed: {{ DateTime.fromISO($json.sync_completed_at).toLocaleString() }}&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;CRM Sync Bot&#34;, &#34;icon_emoji&#34;: &#34;:arrows_counterclockwise:&#34; } }, &#34;id&#34;: &#34;success-notification&#34;, &#34;name&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2440, 320], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#alerts&#34;, &#34;text&#34;: &#34;âŒ CRM Sync Failed\n\n*Error Details:*\nâ€¢ Workflow: {{ $workflow.name }}\nâ€¢ Error: {{ $json.error?.message || &#39;Unknown error&#39; }}\nâ€¢ Time: {{ new Date().toISOString() }}\nâ€¢ Node: {{ $json.error?.node || &#39;Unknown&#39; }}\n\n*Stack Trace:*\n```{{ $json.error?.stack || &#39;No stack trace available&#39; }}```&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;Error Bot&#34;, &#34;icon_emoji&#34;: &#34;:x:&#34; } }, &#34;id&#34;: &#34;error-notification&#34;, &#34;name&#34;: &#34;Send Error Alert&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [900, 580], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } } ], &#34;connections&#34;: { &#34;Every 4 Hours&#34;: { &#34;main&#34;: [ [] ] }, &#34;Split Contact Array&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Validate &amp; Transform Data&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Check if Contact Exists&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Contact Exists?&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ], [ { &#34;node&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Update Existing Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Insert New Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 1 } ] ] }, &#34;Merge Update/Insert Results&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Generate Sync Summary&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] } }, &#34;active&#34;: false, &#34;settings&#34;: { &#34;executionOrder&#34;: &#34;v1&#34;, &#34;saveDataErrorExecution&#34;: &#34;all&#34;, &#34;saveDataSuccessExecution&#34;: &#34;all&#34;, &#34;saveManualExecutions&#34;: true, &#34;callerPolicy&#34;: &#34;workflowsFromSameOwner&#34;, &#34;errorWorkflow&#34;: { &#34;id&#34;: &#34;error-handler-workflow&#34; } }, &#34;versionId&#34;: &#34;crm-sync-advanced-v1&#34;, &#34;meta&#34;: { &#34;templateCredsSetupCompleted&#34;: true }, &#34;id&#34;: &#34;crm-database-sync-advanced&#34;, &#34;tags&#34;: [&#34;crm&#34;, &#34;database&#34;, &#34;synchronization&#34;, &#34;error-handling&#34;, &#34;validation&#34;] } 2. Multi-Step Order Processing Pipeline Purpose: Complex order processing with inventory checks, payment processing, and fulfillment Use Case: E-commerce order management, supply chain automation">
  <meta property="og:url" content="http://localhost:1313/cheatsheats/n8n/advanced_n8n_workflows/">
  <meta property="og:site_name" content="Principles">
  <meta property="og:title" content="Principles">
  <meta property="og:description" content="Advanced n8n Workflow Examples - Database &amp; API Integration Complex workflows with error handling, data validation, and multi-step processing. These examples demonstrate enterprise-level automation patterns.
1. CRM Data Synchronization with Error Handling Purpose: Sync external CRM data to local database with comprehensive error handling Use Case: Customer data synchronization, inventory management, data warehousing
{ &#34;name&#34;: &#34;CRM to Database Sync with Error Handling&#34;, &#34;nodes&#34;: [ { &#34;parameters&#34;: { &#34;rule&#34;: { &#34;interval&#34;: [ { &#34;field&#34;: &#34;cronExpression&#34;, &#34;expression&#34;: &#34;0 */4 * * *&#34; } ] } }, &#34;id&#34;: &#34;schedule-sync&#34;, &#34;name&#34;: &#34;Every 4 Hours&#34;, &#34;type&#34;: &#34;n8n-nodes-base.scheduleTrigger&#34;, &#34;typeVersion&#34;: 1.2, &#34;position&#34;: [240, 400] }, { &#34;parameters&#34;: { &#34;method&#34;: &#34;GET&#34;, &#34;url&#34;: &#34;https://api.crm-system.com/v2/contacts&#34;, &#34;authentication&#34;: &#34;predefinedCredentialType&#34;, &#34;nodeCredentialType&#34;: &#34;httpHeaderAuth&#34;, &#34;sendQuery&#34;: true, &#34;queryParameters&#34;: { &#34;parameters&#34;: [ { &#34;name&#34;: &#34;limit&#34;, &#34;value&#34;: &#34;100&#34; }, { &#34;name&#34;: &#34;updated_since&#34;, &#34;value&#34;: &#34;={{ $workflow.lastSuccessTime || DateTime.now().minus({days: 1}).toISO() }}&#34; }, { &#34;name&#34;: &#34;include_deleted&#34;, &#34;value&#34;: &#34;true&#34; } ] }, &#34;options&#34;: { &#34;pagination&#34;: { &#34;paginationMode&#34;: &#34;updateAParameterInEachRequest&#34;, &#34;paginationCompleteExpression&#34;: &#34;={{ !$response.body.has_more }}&#34;, &#34;limitPagesFetched&#34;: true, &#34;maxRequests&#34;: 20, &#34;pageSize&#34;: 100 }, &#34;retry&#34;: { &#34;enabled&#34;: true, &#34;maxTries&#34;: 3, &#34;waitBetweenTries&#34;: 2000 }, &#34;timeout&#34;: 15000 } }, &#34;id&#34;: &#34;fetch-crm-data&#34;, &#34;name&#34;: &#34;Fetch CRM Contacts&#34;, &#34;type&#34;: &#34;n8n-nodes-base.httpRequest&#34;, &#34;typeVersion&#34;: 4.2, &#34;position&#34;: [460, 400], &#34;credentials&#34;: { &#34;httpHeaderAuth&#34;: { &#34;id&#34;: &#34;crm-api-credentials&#34;, &#34;name&#34;: &#34;CRM API Key&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $json.contacts &amp;&amp; Array.isArray($json.contacts) &amp;&amp; $json.contacts.length &gt; 0 }}&#34;, &#34;operation&#34;: &#34;equal&#34;, &#34;rightValue&#34;: true } } }, &#34;id&#34;: &#34;check-data-exists&#34;, &#34;name&#34;: &#34;Has Contact Data?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [680, 400] }, { &#34;parameters&#34;: { &#34;fieldToSplitOut&#34;: &#34;contacts&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;split-contacts&#34;, &#34;name&#34;: &#34;Split Contact Array&#34;, &#34;type&#34;: &#34;n8n-nodes-base.itemLists&#34;, &#34;typeVersion&#34;: 3.3, &#34;position&#34;: [900, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Validate and transform contact data\nconst validContacts = [];\nconst invalidContacts = [];\n\nfor (const item of $input.all()) {\n const contact = item.json;\n const errors = [];\n \n // Validation rules\n if (!contact.email || !/^[^\\s@]&#43;@[^\\s@]&#43;\\.[^\\s@]&#43;$/.test(contact.email)) {\n errors.push(&#39;Invalid or missing email&#39;);\n }\n \n if (!contact.id || contact.id.toString().length &lt; 1) {\n errors.push(&#39;Missing contact ID&#39;);\n }\n \n if (!contact.first_name || contact.first_name.trim().length &lt; 1) {\n errors.push(&#39;Missing first name&#39;);\n }\n \n if (contact.phone &amp;&amp; !/^[\\&#43;]?[1-9][\\d\\s\\-\\(\\)]{7,15}$/.test(contact.phone.replace(/\\s/g, &#39;&#39;))) {\n errors.push(&#39;Invalid phone number format&#39;);\n }\n \n if (errors.length === 0) {\n // Transform valid contact\n const transformedContact = {\n external_id: contact.id.toString(),\n first_name: contact.first_name.trim(),\n last_name: (contact.last_name || &#39;&#39;).trim(),\n email: contact.email.toLowerCase().trim(),\n phone: contact.phone ? contact.phone.replace(/[^\\d\\&#43;]/g, &#39;&#39;) : null,\n company: (contact.company || &#39;&#39;).trim() || null,\n status: contact.status || &#39;active&#39;,\n tags: Array.isArray(contact.tags) ? contact.tags.join(&#39;,&#39;) : null,\n created_at: contact.created_date || contact.created_at,\n updated_at: contact.updated_date || contact.updated_at,\n is_deleted: contact.is_deleted || false,\n sync_timestamp: new Date().toISOString(),\n source: &#39;crm_sync&#39;\n };\n \n validContacts.push({ json: transformedContact });\n } else {\n // Log invalid contact\n invalidContacts.push({ \n json: { \n original_contact: contact, \n validation_errors: errors,\n rejected_at: new Date().toISOString()\n } \n });\n \n console.log(`Invalid contact ${contact.id}: ${errors.join(&#39;, &#39;)}`);\n }\n}\n\nconsole.log(`Processed ${$input.all().length} contacts: ${validContacts.length} valid, ${invalidContacts.length} invalid`);\n\n// Store invalid contacts for later review\nif (invalidContacts.length &gt; 0) {\n $workflow.staticData.invalidContacts = invalidContacts;\n}\n\nreturn validContacts;&#34; }, &#34;id&#34;: &#34;validate-transform&#34;, &#34;name&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1120, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;select&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;public&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34;, &#34;cachedResultName&#34;: &#34;contacts&#34; }, &#34;where&#34;: { &#34;values&#34;: [ { &#34;column&#34;: &#34;external_id&#34;, &#34;condition&#34;: &#34;equal&#34;, &#34;value&#34;: &#34;={{ $json.external_id }}&#34; } ] }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;check-contact-exists&#34;, &#34;name&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1340, 320], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;conditions&#34;: { &#34;options&#34;: { &#34;leftValue&#34;: &#34;={{ $(&#39;Check if Contact Exists&#39;).itemMatching($itemIndex).json }}&#34;, &#34;operation&#34;: &#34;isNotEmpty&#34; } } }, &#34;id&#34;: &#34;contact-exists-check&#34;, &#34;name&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;n8n-nodes-base.if&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [1560, 320] }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;update&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;updateKey&#34;: &#34;external_id&#34;, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34; } }, &#34;options&#34;: {} }, &#34;id&#34;: &#34;update-contact&#34;, &#34;name&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 220], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;operation&#34;: &#34;insert&#34;, &#34;schema&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;public&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;table&#34;: { &#34;__rl&#34;: true, &#34;value&#34;: &#34;contacts&#34;, &#34;mode&#34;: &#34;list&#34; }, &#34;columns&#34;: { &#34;mappingMode&#34;: &#34;defineBelow&#34;, &#34;value&#34;: { &#34;external_id&#34;: &#34;={{ $json.external_id }}&#34;, &#34;first_name&#34;: &#34;={{ $json.first_name }}&#34;, &#34;last_name&#34;: &#34;={{ $json.last_name }}&#34;, &#34;email&#34;: &#34;={{ $json.email }}&#34;, &#34;phone&#34;: &#34;={{ $json.phone }}&#34;, &#34;company&#34;: &#34;={{ $json.company }}&#34;, &#34;status&#34;: &#34;={{ $json.status }}&#34;, &#34;tags&#34;: &#34;={{ $json.tags }}&#34;, &#34;created_at&#34;: &#34;={{ $json.created_at }}&#34;, &#34;updated_at&#34;: &#34;={{ $json.updated_at }}&#34;, &#34;sync_timestamp&#34;: &#34;={{ $json.sync_timestamp }}&#34;, &#34;is_deleted&#34;: &#34;={{ $json.is_deleted }}&#34;, &#34;source&#34;: &#34;={{ $json.source }}&#34; } }, &#34;options&#34;: { &#34;ignoreDuplicates&#34;: true } }, &#34;id&#34;: &#34;insert-contact&#34;, &#34;name&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;n8n-nodes-base.postgres&#34;, &#34;typeVersion&#34;: 2.4, &#34;position&#34;: [1780, 420], &#34;credentials&#34;: { &#34;postgres&#34;: { &#34;id&#34;: &#34;postgres-db-connection&#34;, &#34;name&#34;: &#34;PostgreSQL Database&#34; } } }, { &#34;parameters&#34;: { &#34;mode&#34;: &#34;combine&#34;, &#34;combinationMode&#34;: &#34;multiplex&#34;, &#34;options&#34;: {} }, &#34;id&#34;: &#34;merge-results&#34;, &#34;name&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;n8n-nodes-base.merge&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2000, 320] }, { &#34;parameters&#34;: { &#34;language&#34;: &#34;javaScript&#34;, &#34;jsCode&#34;: &#34;// Generate sync summary report\nconst allResults = $input.all();\nconst totalProcessed = allResults.length;\n\nconst summary = {\n sync_completed_at: new Date().toISOString(),\n total_contacts_processed: totalProcessed,\n successful_operations: totalProcessed,\n failed_operations: 0,\n invalid_contacts: $workflow.staticData.invalidContacts?.length || 0,\n sync_duration_seconds: Math.round((Date.now() - new Date($(&#39;Every 4 Hours&#39;).first().json.timestamp || Date.now()).getTime()) / 1000),\n next_sync_scheduled: DateTime.now().plus({ hours: 4 }).toISO()\n};\n\n// Log invalid contacts if any\nif ($workflow.staticData.invalidContacts?.length &gt; 0) {\n console.log(&#39;Invalid contacts found:&#39;, JSON.stringify($workflow.staticData.invalidContacts, null, 2));\n}\n\nreturn [{ json: summary }];&#34; }, &#34;id&#34;: &#34;generate-summary&#34;, &#34;name&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;n8n-nodes-base.code&#34;, &#34;typeVersion&#34;: 2, &#34;position&#34;: [2220, 320] }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#data-sync&#34;, &#34;text&#34;: &#34;âœ… CRM Sync Completed Successfully\n\nðŸ“Š *Sync Summary:*\nâ€¢ Total Contacts: {{ $json.total_contacts_processed }}\nâ€¢ Successful: {{ $json.successful_operations }}\nâ€¢ Failed: {{ $json.failed_operations }}\nâ€¢ Invalid: {{ $json.invalid_contacts }}\nâ€¢ Duration: {{ $json.sync_duration_seconds }}s\nâ€¢ Next Sync: {{ DateTime.fromISO($json.next_sync_scheduled).toLocaleString() }}\n\nðŸ• Completed: {{ DateTime.fromISO($json.sync_completed_at).toLocaleString() }}&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;CRM Sync Bot&#34;, &#34;icon_emoji&#34;: &#34;:arrows_counterclockwise:&#34; } }, &#34;id&#34;: &#34;success-notification&#34;, &#34;name&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [2440, 320], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } }, { &#34;parameters&#34;: { &#34;resource&#34;: &#34;message&#34;, &#34;operation&#34;: &#34;post&#34;, &#34;channel&#34;: &#34;#alerts&#34;, &#34;text&#34;: &#34;âŒ CRM Sync Failed\n\n*Error Details:*\nâ€¢ Workflow: {{ $workflow.name }}\nâ€¢ Error: {{ $json.error?.message || &#39;Unknown error&#39; }}\nâ€¢ Time: {{ new Date().toISOString() }}\nâ€¢ Node: {{ $json.error?.node || &#39;Unknown&#39; }}\n\n*Stack Trace:*\n```{{ $json.error?.stack || &#39;No stack trace available&#39; }}```&#34;, &#34;otherOptions&#34;: { &#34;username&#34;: &#34;Error Bot&#34;, &#34;icon_emoji&#34;: &#34;:x:&#34; } }, &#34;id&#34;: &#34;error-notification&#34;, &#34;name&#34;: &#34;Send Error Alert&#34;, &#34;type&#34;: &#34;n8n-nodes-base.slack&#34;, &#34;typeVersion&#34;: 2.1, &#34;position&#34;: [900, 580], &#34;credentials&#34;: { &#34;slackApi&#34;: { &#34;id&#34;: &#34;slack-api-credentials&#34;, &#34;name&#34;: &#34;Slack API Token&#34; } } } ], &#34;connections&#34;: { &#34;Every 4 Hours&#34;: { &#34;main&#34;: [ [] ] }, &#34;Split Contact Array&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Validate &amp; Transform Data&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Validate &amp; Transform Data&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Check if Contact Exists&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Check if Contact Exists&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Contact Exists?&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Contact Exists?&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Update Existing Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ], [ { &#34;node&#34;: &#34;Insert New Contact&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Update Existing Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Insert New Contact&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Merge Update/Insert Results&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 1 } ] ] }, &#34;Merge Update/Insert Results&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Generate Sync Summary&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] }, &#34;Generate Sync Summary&#34;: { &#34;main&#34;: [ [ { &#34;node&#34;: &#34;Send Success Notification&#34;, &#34;type&#34;: &#34;main&#34;, &#34;index&#34;: 0 } ] ] } }, &#34;active&#34;: false, &#34;settings&#34;: { &#34;executionOrder&#34;: &#34;v1&#34;, &#34;saveDataErrorExecution&#34;: &#34;all&#34;, &#34;saveDataSuccessExecution&#34;: &#34;all&#34;, &#34;saveManualExecutions&#34;: true, &#34;callerPolicy&#34;: &#34;workflowsFromSameOwner&#34;, &#34;errorWorkflow&#34;: { &#34;id&#34;: &#34;error-handler-workflow&#34; } }, &#34;versionId&#34;: &#34;crm-sync-advanced-v1&#34;, &#34;meta&#34;: { &#34;templateCredsSetupCompleted&#34;: true }, &#34;id&#34;: &#34;crm-database-sync-advanced&#34;, &#34;tags&#34;: [&#34;crm&#34;, &#34;database&#34;, &#34;synchronization&#34;, &#34;error-handling&#34;, &#34;validation&#34;] } 2. Multi-Step Order Processing Pipeline Purpose: Complex order processing with inventory checks, payment processing, and fulfillment Use Case: E-commerce order management, supply chain automation">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="cheatsheats">
    <meta property="og:image" content="http://localhost:1313/">
   












  </head>

  
  <body>
    
    <div id="blob"></div>
    <div id="blur"></div>
    <div class="container">
      <header class="header">
    <span class="header__inner">
        <a
  href="/"
  style="text-decoration: none;"
>
  <div class="logo">
    
    <span class="logo__mark">></span>
    <span class="logo__text" data-value="Principles"
      >Principles</span
    >
    <span
      class="logo__cursor"
      style="
                   
                   "
    >
    </span>
    
  </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/cheatsheats">CheatSheats</a></li><li><a href="/quotes">Cytaty</a></li><li><a href="/stock">GieÅ‚da</a></li><li><a href="/study">Nauka</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


      <div class="content">
    <main class="post">
        <div class="post-info">
            15 minutes
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/cheatsheats/n8n/advanced_n8n_workflows/"></a></h2>

            
            
            

            <div class="post-content">
                <h1 id="advanced-n8n-workflow-examples---database--api-integration">Advanced n8n Workflow Examples - Database &amp; API Integration</h1>
<p>Complex workflows with error handling, data validation, and multi-step processing. These examples demonstrate enterprise-level automation patterns.</p>
<h2 id="1-crm-data-synchronization-with-error-handling">1. CRM Data Synchronization with Error Handling</h2>
<p><strong>Purpose</strong>: Sync external CRM data to local database with comprehensive error handling
<strong>Use Case</strong>: Customer data synchronization, inventory management, data warehousing</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;CRM to Database Sync with Error Handling&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;nodes&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rule&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;interval&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;field&#34;</span>: <span style="color:#e6db74">&#34;cronExpression&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;expression&#34;</span>: <span style="color:#e6db74">&#34;0 */4 * * *&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;schedule-sync&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Every 4 Hours&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.scheduleTrigger&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">1.2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">400</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;GET&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://api.crm-system.com/v2/contacts&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;authentication&#34;</span>: <span style="color:#e6db74">&#34;predefinedCredentialType&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;nodeCredentialType&#34;</span>: <span style="color:#e6db74">&#34;httpHeaderAuth&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;sendQuery&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;queryParameters&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;parameters&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;limit&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;100&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;updated_since&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;={{ $workflow.lastSuccessTime || DateTime.now().minus({days: 1}).toISO() }}&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;include_deleted&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;pagination&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;paginationMode&#34;</span>: <span style="color:#e6db74">&#34;updateAParameterInEachRequest&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;paginationCompleteExpression&#34;</span>: <span style="color:#e6db74">&#34;={{ !$response.body.has_more }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;limitPagesFetched&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;maxRequests&#34;</span>: <span style="color:#ae81ff">20</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;pageSize&#34;</span>: <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;retry&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;maxTries&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;waitBetweenTries&#34;</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">15000</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;fetch-crm-data&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Fetch CRM Contacts&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.httpRequest&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">4.2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">460</span>, <span style="color:#ae81ff">400</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;httpHeaderAuth&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;crm-api-credentials&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;CRM API Key&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;conditions&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leftValue&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.contacts &amp;&amp; Array.isArray($json.contacts) &amp;&amp; $json.contacts.length &gt; 0 }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;equal&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rightValue&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;check-data-exists&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Has Contact Data?&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.if&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">680</span>, <span style="color:#ae81ff">400</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;fieldToSplitOut&#34;</span>: <span style="color:#e6db74">&#34;contacts&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {}
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;split-contacts&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Split Contact Array&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.itemLists&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">3.3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">900</span>, <span style="color:#ae81ff">320</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;javaScript&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;jsCode&#34;</span>: <span style="color:#e6db74">&#34;// Validate and transform contact data\nconst validContacts = [];\nconst invalidContacts = [];\n\nfor (const item of $input.all()) {\n  const contact = item.json;\n  const errors = [];\n  \n  // Validation rules\n  if (!contact.email || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(contact.email)) {\n    errors.push(&#39;Invalid or missing email&#39;);\n  }\n  \n  if (!contact.id || contact.id.toString().length &lt; 1) {\n    errors.push(&#39;Missing contact ID&#39;);\n  }\n  \n  if (!contact.first_name || contact.first_name.trim().length &lt; 1) {\n    errors.push(&#39;Missing first name&#39;);\n  }\n  \n  if (contact.phone &amp;&amp; !/^[\\+]?[1-9][\\d\\s\\-\\(\\)]{7,15}$/.test(contact.phone.replace(/\\s/g, &#39;&#39;))) {\n    errors.push(&#39;Invalid phone number format&#39;);\n  }\n  \n  if (errors.length === 0) {\n    // Transform valid contact\n    const transformedContact = {\n      external_id: contact.id.toString(),\n      first_name: contact.first_name.trim(),\n      last_name: (contact.last_name || &#39;&#39;).trim(),\n      email: contact.email.toLowerCase().trim(),\n      phone: contact.phone ? contact.phone.replace(/[^\\d\\+]/g, &#39;&#39;) : null,\n      company: (contact.company || &#39;&#39;).trim() || null,\n      status: contact.status || &#39;active&#39;,\n      tags: Array.isArray(contact.tags) ? contact.tags.join(&#39;,&#39;) : null,\n      created_at: contact.created_date || contact.created_at,\n      updated_at: contact.updated_date || contact.updated_at,\n      is_deleted: contact.is_deleted || false,\n      sync_timestamp: new Date().toISOString(),\n      source: &#39;crm_sync&#39;\n    };\n    \n    validContacts.push({ json: transformedContact });\n  } else {\n    // Log invalid contact\n    invalidContacts.push({ \n      json: { \n        original_contact: contact, \n        validation_errors: errors,\n        rejected_at: new Date().toISOString()\n      } \n    });\n    \n    console.log(`Invalid contact ${contact.id}: ${errors.join(&#39;, &#39;)}`);\n  }\n}\n\nconsole.log(`Processed ${$input.all().length} contacts: ${validContacts.length} valid, ${invalidContacts.length} invalid`);\n\n// Store invalid contacts for later review\nif (invalidContacts.length &gt; 0) {\n  $workflow.staticData.invalidContacts = invalidContacts;\n}\n\nreturn validContacts;&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;validate-transform&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Validate &amp; Transform Data&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.code&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1120</span>, <span style="color:#ae81ff">320</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;select&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;schema&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;__rl&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;public&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;list&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;cachedResultName&#34;</span>: <span style="color:#e6db74">&#34;public&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;table&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;__rl&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;contacts&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;list&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;cachedResultName&#34;</span>: <span style="color:#e6db74">&#34;contacts&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;where&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;values&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;column&#34;</span>: <span style="color:#e6db74">&#34;external_id&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;condition&#34;</span>: <span style="color:#e6db74">&#34;equal&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.external_id }}&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {}
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;check-contact-exists&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Check if Contact Exists&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.postgres&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2.4</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1340</span>, <span style="color:#ae81ff">320</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;postgres&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;postgres-db-connection&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;PostgreSQL Database&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;conditions&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leftValue&#34;</span>: <span style="color:#e6db74">&#34;={{ $(&#39;Check if Contact Exists&#39;).itemMatching($itemIndex).json }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;isNotEmpty&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;contact-exists-check&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Contact Exists?&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.if&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1560</span>, <span style="color:#ae81ff">320</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;update&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;schema&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;__rl&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;public&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;table&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;__rl&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;contacts&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;updateKey&#34;</span>: <span style="color:#e6db74">&#34;external_id&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;columns&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mappingMode&#34;</span>: <span style="color:#e6db74">&#34;defineBelow&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;first_name&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.first_name }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_name&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.last_name }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.email }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;phone&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.phone }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;company&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.company }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.status }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;tags&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.tags }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;updated_at&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.updated_at }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;sync_timestamp&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.sync_timestamp }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;is_deleted&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.is_deleted }}&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {}
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;update-contact&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Update Existing Contact&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.postgres&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2.4</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1780</span>, <span style="color:#ae81ff">220</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;postgres&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;postgres-db-connection&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;PostgreSQL Database&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;insert&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;schema&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;__rl&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;public&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;table&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;__rl&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;contacts&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;columns&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;mappingMode&#34;</span>: <span style="color:#e6db74">&#34;defineBelow&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;value&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;external_id&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.external_id }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;first_name&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.first_name }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_name&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.last_name }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.email }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;phone&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.phone }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;company&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.company }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.status }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;tags&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.tags }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;created_at&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.created_at }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;updated_at&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.updated_at }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;sync_timestamp&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.sync_timestamp }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;is_deleted&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.is_deleted }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.source }}&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;ignoreDuplicates&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;insert-contact&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Insert New Contact&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.postgres&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2.4</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1780</span>, <span style="color:#ae81ff">420</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;postgres&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;postgres-db-connection&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;PostgreSQL Database&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;combine&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;combinationMode&#34;</span>: <span style="color:#e6db74">&#34;multiplex&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {}
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;merge-results&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Merge Update/Insert Results&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.merge&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2.1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">2000</span>, <span style="color:#ae81ff">320</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;javaScript&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;jsCode&#34;</span>: <span style="color:#e6db74">&#34;// Generate sync summary report\nconst allResults = $input.all();\nconst totalProcessed = allResults.length;\n\nconst summary = {\n  sync_completed_at: new Date().toISOString(),\n  total_contacts_processed: totalProcessed,\n  successful_operations: totalProcessed,\n  failed_operations: 0,\n  invalid_contacts: $workflow.staticData.invalidContacts?.length || 0,\n  sync_duration_seconds: Math.round((Date.now() - new Date($(&#39;Every 4 Hours&#39;).first().json.timestamp || Date.now()).getTime()) / 1000),\n  next_sync_scheduled: DateTime.now().plus({ hours: 4 }).toISO()\n};\n\n// Log invalid contacts if any\nif ($workflow.staticData.invalidContacts?.length &gt; 0) {\n  console.log(&#39;Invalid contacts found:&#39;, JSON.stringify($workflow.staticData.invalidContacts, null, 2));\n}\n\nreturn [{ json: summary }];&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;generate-summary&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Generate Sync Summary&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.code&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">2220</span>, <span style="color:#ae81ff">320</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;resource&#34;</span>: <span style="color:#e6db74">&#34;message&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;post&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;channel&#34;</span>: <span style="color:#e6db74">&#34;#data-sync&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;âœ… CRM Sync Completed Successfully\n\nðŸ“Š *Sync Summary:*\nâ€¢ Total Contacts: {{ $json.total_contacts_processed }}\nâ€¢ Successful: {{ $json.successful_operations }}\nâ€¢ Failed: {{ $json.failed_operations }}\nâ€¢ Invalid: {{ $json.invalid_contacts }}\nâ€¢ Duration: {{ $json.sync_duration_seconds }}s\nâ€¢ Next Sync: {{ DateTime.fromISO($json.next_sync_scheduled).toLocaleString() }}\n\nðŸ• Completed: {{ DateTime.fromISO($json.sync_completed_at).toLocaleString() }}&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;otherOptions&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;CRM Sync Bot&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;icon_emoji&#34;</span>: <span style="color:#e6db74">&#34;:arrows_counterclockwise:&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;success-notification&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Send Success Notification&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.slack&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2.1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">2440</span>, <span style="color:#ae81ff">320</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;slackApi&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;slack-api-credentials&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Slack API Token&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;resource&#34;</span>: <span style="color:#e6db74">&#34;message&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;post&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;channel&#34;</span>: <span style="color:#e6db74">&#34;#alerts&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;âŒ CRM Sync Failed\n\n*Error Details:*\nâ€¢ Workflow: {{ $workflow.name }}\nâ€¢ Error: {{ $json.error?.message || &#39;Unknown error&#39; }}\nâ€¢ Time: {{ new Date().toISOString() }}\nâ€¢ Node: {{ $json.error?.node || &#39;Unknown&#39; }}\n\n*Stack Trace:*\n```{{ $json.error?.stack || &#39;No stack trace available&#39; }}```&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;otherOptions&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;Error Bot&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;icon_emoji&#34;</span>: <span style="color:#e6db74">&#34;:x:&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;error-notification&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Send Error Alert&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.slack&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2.1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">900</span>, <span style="color:#ae81ff">580</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;slackApi&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;slack-api-credentials&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Slack API Token&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;connections&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Every 4 Hours&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        []
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Split Contact Array&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Validate &amp; Transform Data&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Validate &amp; Transform Data&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Check if Contact Exists&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Check if Contact Exists&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Contact Exists?&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Contact Exists?&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Update Existing Contact&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Insert New Contact&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Update Existing Contact&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Merge Update/Insert Results&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Insert New Contact&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Merge Update/Insert Results&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Merge Update/Insert Results&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Generate Sync Summary&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Generate Sync Summary&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;main&#34;</span>: [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;Send Success Notification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;active&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;settings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;executionOrder&#34;</span>: <span style="color:#e6db74">&#34;v1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;saveDataErrorExecution&#34;</span>: <span style="color:#e6db74">&#34;all&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;saveDataSuccessExecution&#34;</span>: <span style="color:#e6db74">&#34;all&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;saveManualExecutions&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;callerPolicy&#34;</span>: <span style="color:#e6db74">&#34;workflowsFromSameOwner&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;errorWorkflow&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;error-handler-workflow&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;versionId&#34;</span>: <span style="color:#e6db74">&#34;crm-sync-advanced-v1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;meta&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;templateCredsSetupCompleted&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;crm-database-sync-advanced&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;tags&#34;</span>: [<span style="color:#e6db74">&#34;crm&#34;</span>, <span style="color:#e6db74">&#34;database&#34;</span>, <span style="color:#e6db74">&#34;synchronization&#34;</span>, <span style="color:#e6db74">&#34;error-handling&#34;</span>, <span style="color:#e6db74">&#34;validation&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="2-multi-step-order-processing-pipeline">2. Multi-Step Order Processing Pipeline</h2>
<p><strong>Purpose</strong>: Complex order processing with inventory checks, payment processing, and fulfillment
<strong>Use Case</strong>: E-commerce order management, supply chain automation</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Advanced Order Processing Pipeline&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;nodes&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;httpMethod&#34;</span>: <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;orders/process&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;authentication&#34;</span>: <span style="color:#e6db74">&#34;headerAuth&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;allowedOrigins&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;rawBody&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;order-webhook&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Order Processing Webhook&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.webhook&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">1.1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">400</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;webhookId&#34;</span>: <span style="color:#e6db74">&#34;order-processing-webhook-id&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;javaScript&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;jsCode&#34;</span>: <span style="color:#e6db74">&#34;// Initialize order processing with comprehensive validation\nconst order = $input.first().json;\nconst orderId = order.id || `ORD_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n// Comprehensive validation\nconst validationErrors = [];\nconst requiredFields = [&#39;customer_id&#39;, &#39;items&#39;, &#39;total_amount&#39;, &#39;shipping_address&#39;];\n\nrequiredFields.forEach(field =&gt; {\n  if (!order[field]) {\n    validationErrors.push(`Missing required field: ${field}`);\n  }\n});\n\n// Validate items array\nif (order.items &amp;&amp; Array.isArray(order.items)) {\n  order.items.forEach((item, index) =&gt; {\n    if (!item.product_id || !item.quantity || !item.price) {\n      validationErrors.push(`Item ${index + 1}: Missing required fields (product_id, quantity, price)`);\n    }\n    if (item.quantity &lt;= 0) {\n      validationErrors.push(`Item ${index + 1}: Invalid quantity`);\n    }\n    if (item.price &lt;= 0) {\n      validationErrors.push(`Item ${index + 1}: Invalid price`);\n    }\n  });\n} else if (order.items) {\n  validationErrors.push(&#39;Items must be an array&#39;);\n}\n\n// Validate shipping address\nif (order.shipping_address) {\n  const addr = order.shipping_address;\n  const addressFields = [&#39;street&#39;, &#39;city&#39;, &#39;country&#39;];\n  addressFields.forEach(field =&gt; {\n    if (!addr[field]) {\n      validationErrors.push(`Missing shipping address field: ${field}`);\n    }\n  });\n}\n\nif (validationErrors.length &gt; 0) {\n  throw new Error(`Order validation failed: ${validationErrors.join(&#39;, &#39;)}`);\n}\n\n// Initialize workflow state\nconst state = $workflow.staticData;\nif (!state.orders) state.orders = {};\nif (!state.processingEvents) state.processingEvents = [];\n\n// Create comprehensive order state\nstate.orders[orderId] = {\n  id: orderId,\n  original_order: order,\n  status: &#39;received&#39;,\n  customer_id: order.customer_id,\n  items: order.items.map(item =&gt; ({\n    ...item,\n    line_total: item.quantity * item.price\n  })),\n  total_amount: parseFloat(order.total_amount),\n  currency: order.currency || &#39;USD&#39;,\n  shipping_address: order.shipping_address,\n  billing_address: order.billing_address || order.shipping_address,\n  payment_method: order.payment_method || &#39;credit_card&#39;,\n  priority: order.priority || &#39;standard&#39;,\n  created_at: new Date().toISOString(),\n  updated_at: new Date().toISOString(),\n  processing_pipeline: {\n    validation: { status: &#39;completed&#39;, completed_at: new Date().toISOString() },\n    inventory_check: { status: &#39;pending&#39; },\n    pricing_validation: { status: &#39;pending&#39; },\n    payment_processing: { status: &#39;pending&#39; },\n    fulfillment_creation: { status: &#39;pending&#39; },\n    notification: { status: &#39;pending&#39; }\n  },\n  metrics: {\n    processing_start_time: new Date().toISOString(),\n    items_count: order.items.length,\n    calculated_total: order.items.reduce((sum, item) =&gt; sum + (item.quantity * item.price), 0)\n  }\n};\n\n// Log processing start event\nstate.processingEvents.push({\n  order_id: orderId,\n  event_type: &#39;order_received&#39;,\n  timestamp: new Date().toISOString(),\n  data: { \n    items_count: order.items.length,\n    total_amount: order.total_amount,\n    customer_id: order.customer_id\n  }\n});\n\nconsole.log(`Order ${orderId} initialized and validated successfully`);\n\nreturn [{ json: { \n  ...state.orders[orderId], \n  processing_stage: &#39;inventory_check&#39;,\n  validation_passed: true\n}}];&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;initialize-order&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Initialize &amp; Validate Order&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.code&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">460</span>, <span style="color:#ae81ff">400</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;batchSize&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;reset&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;batch-process-items&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Batch Process Items&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.splitInBatches&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">680</span>, <span style="color:#ae81ff">400</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;fieldToSplitOut&#34;</span>: <span style="color:#e6db74">&#34;items&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {}
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;split-order-items&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Split Order Items&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.itemLists&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">3.3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">900</span>, <span style="color:#ae81ff">400</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://api.inventory.internal/v2/check-availability&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;authentication&#34;</span>: <span style="color:#e6db74">&#34;predefinedCredentialType&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;nodeCredentialType&#34;</span>: <span style="color:#e6db74">&#34;httpHeaderAuth&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;sendBody&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;bodyContentType&#34;</span>: <span style="color:#e6db74">&#34;json&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;jsonBody&#34;</span>: <span style="color:#e6db74">&#34;={{ {\n  product_id: $json.product_id,\n  quantity_requested: $json.quantity,\n  warehouse_preference: $(&#39;Initialize &amp; Validate Order&#39;).first().json.shipping_address.country,\n  priority: $(&#39;Initialize &amp; Validate Order&#39;).first().json.priority,\n  customer_tier: &#39;standard&#39;\n} }}&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">8000</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;retry&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;maxTries&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;waitBetweenTries&#34;</span>: <span style="color:#ae81ff">1500</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;check-inventory-availability&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Check Inventory Availability&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.httpRequest&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">4.2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1120</span>, <span style="color:#ae81ff">400</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;httpHeaderAuth&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;inventory-service-api&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Inventory Service API&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://api.pricing.internal/v1/validate-pricing&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;authentication&#34;</span>: <span style="color:#e6db74">&#34;predefinedCredentialType&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;nodeCredentialType&#34;</span>: <span style="color:#e6db74">&#34;httpHeaderAuth&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;sendBody&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;bodyContentType&#34;</span>: <span style="color:#e6db74">&#34;json&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;jsonBody&#34;</span>: <span style="color:#e6db74">&#34;={{ {\n  product_id: $json.product_id,\n  stated_price: $json.price,\n  quantity: $json.quantity,\n  customer_id: $(&#39;Initialize &amp; Validate Order&#39;).first().json.customer_id,\n  currency: $(&#39;Initialize &amp; Validate Order&#39;).first().json.currency,\n  effective_date: new Date().toISOString()\n} }}&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5000</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;retry&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;maxTries&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;waitBetweenTries&#34;</span>: <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;validate-pricing&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Validate Item Pricing&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.httpRequest&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">4.2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1120</span>, <span style="color:#ae81ff">320</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;credentials&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;httpHeaderAuth&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;pricing-service-api&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Pricing Service API&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;combine&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;combinationMode&#34;</span>: <span style="color:#e6db74">&#34;mergeByPosition&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {}
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;merge-item-checks&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Merge Inventory &amp; Pricing&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.merge&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2.1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1340</span>, <span style="color:#ae81ff">360</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;language&#34;</span>: <span style="color:#e6db74">&#34;javaScript&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;jsCode&#34;</span>: <span style="color:#e6db74">&#34;// Process and aggregate item validation results\nconst currentBatch = $input.all();\nconst orderId = $(&#39;Initialize &amp; Validate Order&#39;).first().json.id;\nconst state = $workflow.staticData;\n\n// Initialize aggregation results if not exists\nif (!state.orders[orderId].item_validation_results) {\n  state.orders[orderId].item_validation_results = {\n    processed_items: [],\n    inventory_issues: [],\n    pricing_issues: [],\n    total_items: state.orders[orderId].items.length,\n    processed_count: 0,\n    all_items_available: true,\n    all_prices_valid: true\n  };\n}\n\nconst results = state.orders[orderId].item_validation_results;\n\n// Process current batch\ncurrentBatch.forEach(item =&gt; {\n  const originalItem = item.json;\n  const inventoryCheck = $(&#39;Check Inventory Availability&#39;).itemMatching(results.processed_count).json;\n  const pricingCheck = $(&#39;Validate Item Pricing&#39;).itemMatching(results.processed_count).json;\n  \n  const itemResult = {\n    product_id: originalItem.product_id,\n    requested_quantity: originalItem.quantity,\n    stated_price: originalItem.price,\n    inventory_available: inventoryCheck.available_quantity &gt;= originalItem.quantity,\n    available_quantity: inventoryCheck.available_quantity,\n    warehouse_locations: inventoryCheck.warehouse_locations || [],\n    pricing_valid: pricingCheck.price_valid,\n    current_price: pricingCheck.current_price,\n    price_difference: pricingCheck.current_price - originalItem.price,\n    validation_timestamp: new Date().toISOString()\n  };\n  \n  results.processed_items.push(itemResult);\n  results.processed_count += 1;\n  \n  // Track issues\n  if (!itemResult.inventory_available) {\n    results.all_items_available = false;\n    results.inventory_issues.push({\n      product_id: itemResult.product_id,\n      requested: itemResult.requested_quantity,\n      available: itemResult.available_quantity,\n      shortage: itemResult.requested_quantity - itemResult.available_quantity\n    });\n  }\n  \n  if (!itemResult.pricing_valid) {\n    results.all_prices_valid = false;\n    results.pricing_issues.push({\n      product_id: itemResult.product_id,\n      stated_price: itemResult.stated_price,\n      current_price: itemResult.current_price,\n      difference: itemResult.price_difference\n    });\n  }\n});\n\n// Check if all items processed\nconst allItemsProcessed = results.processed_count &gt;= results.total_items;\n\nif (allItemsProcessed) {\n  // Update order status based on validation results\n  if (results.all_items_available &amp;&amp; results.all_prices_valid) {\n    state.orders[orderId].status = &#39;validated&#39;;\n    state.orders[orderId].processing_pipeline.inventory_check.status = &#39;completed&#39;;\n    state.orders[orderId].processing_pipeline.pricing_validation.status = &#39;completed&#39;;\n  } else {\n    state.orders[orderId].status = &#39;validation_failed&#39;;\n    if (!results.all_items_available) {\n      state.orders[orderId].processing_pipeline.inventory_check.status = &#39;failed&#39;;\n    }\n    if (!results.all_prices_valid) {\n      state.orders[orderId].processing_pipeline.pricing_validation.status = &#39;failed&#39;;\n    }\n  }\n  \n  state.orders[orderId].processing_pipeline.inventory_check.completed_at = new Date().toISOString();\n  state.orders[orderId].processing_pipeline.pricing_validation.completed_at = new Date().toISOString();\n  state.orders[orderId].updated_at = new Date().toISOString();\n  \n  // Log validation completion event\n  state.processingEvents.push({\n    order_id: orderId,\n    event_type: results.all_items_available &amp;&amp; results.all_prices_valid ? &#39;validation_passed&#39; : &#39;validation_failed&#39;,\n    timestamp: new Date().toISOString(),\n    data: {\n      items_processed: results.processed_count,\n      inventory_available: results.all_items_available,\n      pricing_valid: results.all_prices_valid,\n      inventory_issues: results.inventory_issues.length,\n      pricing_issues: results.pricing_issues.length\n    }\n  });\n}\n\nreturn [{ json: {\n  ...state.orders[orderId],\n  validation_complete: allItemsProcessed,\n  processing_stage: allItemsProcessed ? \n    (results.all_items_available &amp;&amp; results.all_prices_valid ? &#39;payment_processing&#39; : &#39;validation_failed&#39;) : \n    &#39;validating_items&#39;\n}}];&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;aggregate-validation&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Aggregate Item Validation&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.code&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1560</span>, <span style="color:#ae81ff">360</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;conditions&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leftValue&#34;</span>: <span style="color:#e6db74">&#34;={{ $json.validation_complete &amp;&amp; $json.item_validation_results.all_items_available &amp;&amp; $json.item_validation_results.all_prices_valid }}&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;operation&#34;</span>: <span style="color:#e6db74">&#34;equal&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rightValue&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;validation-success-check&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Validation Passed?&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;n8n-nodes-base.if&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;typeVersion&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;position&#34;</span>: [<span style="color:#ae81ff">1780</span>, <span style="color:#ae81ff">360</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://api.payments.internal/v2/process-payment&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;authentication&#34;</span>: <span style="color:#e6db74">&#34;predefinedCredentialType&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;nodeCredentialType&#34;</span>: <span style="color:#e6db74">&#34;httpHeaderAuth&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;sendBody&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;bodyContentType&#34;</span>: <span style="color:#e6db74">&#34;json&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;jsonBody&#34;</span>: <span style="color:#e6db74">&#34;={{ {\n  order_id: $json.id,\n  customer_id: $json.customer_id,\n  amount: $json.total_amount,\n  currency: $json.currency,\n  payment_method: $json.payment_method,\n  billing_address: $json.billing_address,\n  items: $json.items.map(item =&gt; ({\n    product_id: item.product_id,\n    quantity: item.quantity,\n    unit_price: item.price,\n    line_total: item.line_total\n  })),\n  metadata: {\n    order_created_at: $json.created_at,\n    processing_priority: $json.priority,\n    customer_tier: &#39;standard&#39;\n  }\n} }}&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">15000</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;retry&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;maxTries&#34;</span>: <span style="color:#ae81ff">2</span>,<span style="color:#960050;background-color:#1e0010">\n</span>            <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&#34;waitBetweenTries\&#34;: 3000\n          }\n        }\n      },\n      \&#34;id\&#34;: \&#34;process-payment\&#34;,\n      \&#34;name\&#34;: \&#34;Process Payment\&#34;,\n      \&#34;type\&#34;: \&#34;n8n-nodes-base.httpRequest\&#34;,\n      \&#34;typeVersion\&#34;: 4.2,\n      \&#34;position\&#34;: [2000, 280],\n      \&#34;credentials\&#34;: {\n        \&#34;httpHeaderAuth\&#34;: {\n          \&#34;id\&#34;: \&#34;payment-service-api\&#34;,\n          \&#34;name\&#34;: \&#34;Payment Service API\&#34;\n        }\n      }\n    },\n    {\n      \&#34;parameters\&#34;: {\n        \&#34;language\&#34;: \&#34;javaScript\&#34;,\n        \&#34;jsCode\&#34;: \&#34;// Handle payment processing response\\nconst order = $input.first().json;\\nconst paymentResponse = $(&#39;Process Payment&#39;).first().json;\\nconst orderId = order.id;\\nconst state = $workflow.staticData;\\n\\n// Update payment processing status\\nstate.orders[orderId].processing_pipeline.payment_processing.status = &#39;completed&#39;;\\nstate.orders[orderId].processing_pipeline.payment_processing.completed_at = new Date().toISOString();\\n\\n// Store detailed payment information\\nstate.orders[orderId].payment_details = {\\n  transaction_id: paymentResponse.transaction_id,\\n  gateway_response_id: paymentResponse.gateway_response_id,\\n  payment_method_used: paymentResponse.payment_method,\\n  amount_charged: paymentResponse.amount_charged,\\n  currency: paymentResponse.currency,\\n  gateway_status: paymentResponse.status,\\n  gateway_message: paymentResponse.message,\\n  processing_fee: paymentResponse.processing_fee || 0,\\n  net_amount: paymentResponse.amount_charged - (paymentResponse.processing_fee || 0),\\n  processed_at: paymentResponse.processed_at,\\n  risk_score: paymentResponse.risk_assessment?.score || null,\\n  fraud_flags: paymentResponse.risk_assessment?.flags || []\\n};\\n\\nif (paymentResponse.status === &#39;success&#39; || paymentResponse.status === &#39;completed&#39;) {\\n  state.orders[orderId].status = &#39;payment_confirmed&#39;;\\n  \\n  // Calculate processing metrics\\n  const processingTime = new Date().getTime() - new Date(state.orders[orderId].created_at).getTime();\\n  state.orders[orderId].metrics.payment_processing_time_ms = processingTime;\\n  \\n  // Log successful payment\\n  state.processingEvents.push({\\n    order_id: orderId,\\n    event_type: &#39;payment_success&#39;,\\n    timestamp: new Date().toISOString(),\\n    data: {\\n      transaction_id: paymentResponse.transaction_id,\\n      amount_charged: paymentResponse.amount_charged,\\n      processing_time_ms: processingTime,\\n      risk_score: paymentResponse.risk_assessment?.score\\n    }\\n  });\\n} else {\\n  state.orders[orderId].status = &#39;payment_failed&#39;;\\n  state.orders[orderId].processing_pipeline.payment_processing.status = &#39;failed&#39;;\\n  state.orders[orderId].processing_pipeline.payment_processing.error = {\\n    code: paymentResponse.error_code,\\n    message: paymentResponse.error_message,\\n    details: paymentResponse.error_details\\n  };\\n  \\n  // Log payment failure\\n  state.processingEvents.push({\\n    order_id: orderId,\\n    event_type: &#39;payment_failed&#39;,\\n    timestamp: new Date().toISOString(),\\n    data: {\\n      error_code: paymentResponse.error_code,\\n      error_message: paymentResponse.error_message,\\n      amount_attempted: order.total_amount\\n    }\\n  });\\n}\\n\\nstate.orders[orderId].updated_at = new Date().toISOString();\\n\\nreturn [{ json: { \\n  ...state.orders[orderId], \\n  payment_successful: paymentResponse.status === &#39;success&#39; || paymentResponse.status === &#39;completed&#39;,\\n  processing_stage: (paymentResponse.status === &#39;success&#39; || paymentResponse.status === &#39;completed&#39;) ? &#39;fulfillment_creation&#39; : &#39;payment_failed&#39;\\n}}];\&#34;\n      },\n      \&#34;id\&#34;: \&#34;handle-payment-response\&#34;,\n      \&#34;name\&#34;: \&#34;Handle Payment Response\&#34;,\n      \&#34;type\&#34;: \&#34;n8n-nodes-base.code\&#34;,\n      \&#34;typeVersion\&#34;: 2,\n      \&#34;position\&#34;: [2220, 280]\n    }\n  ],\n  \&#34;connections\&#34;: {\n    \&#34;Order Processing Webhook\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Initialize &amp; Validate Order\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    },\n    \&#34;Initialize &amp; Validate Order\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Batch Process Items\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    },\n    \&#34;Batch Process Items\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Split Order Items\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    },\n    \&#34;Split Order Items\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Check Inventory Availability\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          },\n          {\n            \&#34;node\&#34;: \&#34;Validate Item Pricing\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    },\n    \&#34;Check Inventory Availability\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Merge Inventory &amp; Pricing\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    },\n    \&#34;Validate Item Pricing\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Merge Inventory &amp; Pricing\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 1\n          }\n        ]\n      ]\n    },\n    \&#34;Merge Inventory &amp; Pricing\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Aggregate Item Validation\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    },\n    \&#34;Aggregate Item Validation\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Validation Passed?\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    },\n    \&#34;Validation Passed?\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Process Payment\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ],\n        []\n      ]\n    },\n    \&#34;Process Payment\&#34;: {\n      \&#34;main\&#34;: [\n        [\n          {\n            \&#34;node\&#34;: \&#34;Handle Payment Response\&#34;,\n            \&#34;type\&#34;: \&#34;main\&#34;,\n            \&#34;index\&#34;: 0\n          }\n        ]\n      ]\n    }\n  },\n  \&#34;active\&#34;: false,\n  \&#34;settings\&#34;: {\n    \&#34;executionOrder\&#34;: \&#34;v1\&#34;,\n    \&#34;saveDataErrorExecution\&#34;: \&#34;all\&#34;,\n    \&#34;saveDataSuccessExecution\&#34;: \&#34;all\&#34;,\n    \&#34;saveManualExecutions\&#34;: true,\n    \&#34;callerPolicy\&#34;: \&#34;workflowsFromSameOwner\&#34;,\n    \&#34;errorWorkflow\&#34;: {\n      \&#34;id\&#34;: \&#34;order-processing-error-handler\&#34;\n    }\n  },\n  \&#34;versionId\&#34;: \&#34;advanced-order-processing-v1\&#34;,\n  \&#34;meta\&#34;: {\n    \&#34;templateCredsSetupCompleted\&#34;: true\n  },\n  \&#34;id\&#34;: \&#34;advanced-order-processing-pipeline\&#34;,\n  \&#34;tags\&#34;: [\&#34;order-processing\&#34;, \&#34;e-commerce\&#34;, \&#34;payment\&#34;, \&#34;inventory\&#34;, \&#34;validation\&#34;]\n}\n```\n\n## Setup Instructions for Advanced Workflows\n\n### Prerequisites:\n1. **Database Setup** (PostgreSQL recommended):\n   ```sql\n   CREATE TABLE contacts (\n     id SERIAL PRIMARY KEY,\n     external_id VARCHAR(255) UNIQUE NOT NULL,\n     first_name VARCHAR(255) NOT NULL,\n     last_name VARCHAR(255),\n     email VARCHAR(255) UNIQUE NOT NULL,\n     phone VARCHAR(50),\n     company VARCHAR(255),\n     status VARCHAR(50) DEFAULT &#39;active&#39;,\n     tags TEXT,\n     created_at TIMESTAMP,\n     updated_at TIMESTAMP,\n     sync_timestamp TIMESTAMP,\n     is_deleted BOOLEAN DEFAULT false,\n     source VARCHAR(100)\n   );\n   ```\n\n2. **API Credentials Setup**:\n   - CRM API authentication\n   - Inventory service API\n   - Payment processing API\n   - Pricing service API\n   - Slack workspace integration\n\n### Import Process:\n1. Copy the JSON workflow\n2. Import via n8n interface\n3. Configure all credential connections\n4. Update API endpoints to match your services\n5. Test with sample data\n6. Set up error handling workflows\n7. Configure monitoring and alerting\n\n### Key Features:\n- **State Management**: Uses `workflowStaticData` for complex state tracking\n- **Batch Processing**: Handles large datasets efficiently\n- **Comprehensive Validation**: Multi-level data validation\n- **Error Handling**: Robust error tracking and notifications\n- **Performance Monitoring**: Processing time and success metrics\n- **Audit Trail**: Complete event logging for compliance\n- **Scalable Architecture**: Microservice integration patterns
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">          {
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">            &#34;</span><span style="color:#960050;background-color:#1e0010">node</span><span style="color:#e6db74">&#34;: &#34;</span><span style="color:#960050;background-color:#1e0010">Fetch</span> <span style="color:#960050;background-color:#1e0010">CRM</span> <span style="color:#960050;background-color:#1e0010">Contacts</span><span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">type</span><span style="color:#e6db74">&#34;: &#34;</span><span style="color:#960050;background-color:#1e0010">main</span><span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">index</span><span style="color:#e6db74">&#34;: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;</span><span style="color:#960050;background-color:#1e0010">Fetch</span> <span style="color:#960050;background-color:#1e0010">CRM</span> <span style="color:#960050;background-color:#1e0010">Contacts</span><span style="color:#e6db74">&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;</span><span style="color:#960050;background-color:#1e0010">main</span><span style="color:#e6db74">&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">node</span><span style="color:#e6db74">&#34;: &#34;</span><span style="color:#960050;background-color:#1e0010">Has</span> <span style="color:#960050;background-color:#1e0010">Contact</span> <span style="color:#960050;background-color:#1e0010">Data?</span><span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">type</span><span style="color:#e6db74">&#34;: &#34;</span><span style="color:#960050;background-color:#1e0010">main</span><span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">index</span><span style="color:#e6db74">&#34;: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;</span><span style="color:#960050;background-color:#1e0010">Has</span> <span style="color:#960050;background-color:#1e0010">Contact</span> <span style="color:#960050;background-color:#1e0010">Data?</span><span style="color:#e6db74">&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;</span><span style="color:#960050;background-color:#1e0010">main</span><span style="color:#e6db74">&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">node</span><span style="color:#e6db74">&#34;: &#34;</span><span style="color:#960050;background-color:#1e0010">Split</span> <span style="color:#960050;background-color:#1e0010">Contact</span> <span style="color:#960050;background-color:#1e0010">Array</span><span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">type</span><span style="color:#e6db74">&#34;: &#34;</span><span style="color:#960050;background-color:#1e0010">main</span><span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span><span style="color:#960050;background-color:#1e0010">index&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">]</span>,
</span></span><span style="display:flex;"><span>        
</span></span></code></pre></div>
            </div>
        </article>
        <hr />

        <div class="post-info">
            
            category
  		</div>
    </main>
</div>

       <footer class="footer">
    
    
</footer>
 
    </div>

    



<script type="text/javascript" src="/bundle.min.17f4a297973019cb34411034a36394fcb6eacdd75534644a62f64d85ac204bca0405d8a5b5f4babfd7625a6307b48c86d042051a47e0506e4147dda733ef13aa.js" integrity="sha512-F/Sil5cwGcs0QRA0o2OU/LbqzddVNGRKYvZNhawgS8oEBdiltfS6v9diWmMHtIyG0EIFGkfgUG5BR92nM&#43;8Tqg=="></script>



  </body>
</html>
